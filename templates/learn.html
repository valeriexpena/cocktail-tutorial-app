{% extends "base.html" %}

{% block title %}{{ cocktail_name }} - Step {{ step_id }}{% endblock %}

{% block content %}
<body class="learn-body">
  <h1 class="learn-title">How to Make {{ cocktail_name }}</h1>
  <h2>Step {{ step_id }}</h2>

  <div class="learn-flex-container">
    <div class="learn-flex-child">
      <p>{{ step_data["text_left"] }}</p>
      {% for img in step_data["media_left"] %}
        <img class="learn-img-large" src="/static/{{ img }}">
      {% endfor %}
    </div>

    <div class="learn-flex-child">
      <p>{{ step_data["text_right"] }}</p>

      <!-- Make right-side media a horizontal row -->
      <div style="display: flex; flex-direction: row; gap: 20px; flex-wrap: wrap; justify-content: center;">
        {% for img in step_data["media_right"] %}
          {% if "lemon.png" in img %}
            <img id="lemon" class="learn-img-small"
                 src="/static/{{ img }}"
                 ondragover="event.preventDefault()"
                 ondrop="handleDrop(event, 'lemon')">

          {% elif "lemon_sliced.png" in img %}
            <img id="lemon-sliced" class="learn-img-small"
                 src="/static/{{ img }}"
                 style="display: none;"
                 alt="Sliced lemon">

          {% elif "knife" in img %}
            <img id="knife" class="learn-img-small"
                 src="/static/{{ img }}"
                 draggable="true"
                 ondragstart="handleDragStart(event)">

          {% elif "ice_cube" in img %}
            <img id="ice-cube" class="learn-img-small"
                 src="/static/{{ img }}"
                 draggable="true"
                 ondragstart="handleDragStart(event)">

          {% elif "shaker" in img %}
            <img id="shaker" class="learn-img-small"
                 src="/static/{{ img }}"
                 ondragover="event.preventDefault()"
                 ondrop="handleDrop(event, 'shaker')">

          {% elif "glass" in img or "highball" in img %}
            <img id="glass" class="learn-img-small"
                 src="/static/{{ img }}"
                 ondragover="event.preventDefault()"
                 ondrop="handleDrop(event, 'glass')">

          {% else %}
            <img class="learn-img-small" src="/static/{{ img }}">
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <div style="margin-top: 40px;">
    {% if prev_step_id is not none %}
      <a href="/cocktail/{{ drink_id }}/step/{{ prev_step_id }}">
        <button class="button-back">Back</button>
      </a>
    {% endif %}

    {% if next_step_id is not none %}
      <a href="/cocktail/{{ drink_id }}/step/{{ next_step_id }}" id="next-button" style="display: none;">
        <button class="button-next">Next</button>
      </a>
    {% endif %}
  </div>

  <script>
    function handleDragStart(event) {
      event.dataTransfer.setData("text/plain", event.target.id);
    }

    function handleDrop(event, target) {
      event.preventDefault();
      const draggedId = event.dataTransfer.getData("text/plain");

      if (draggedId === "knife" && target === "lemon") {
        document.getElementById("lemon").style.display = "none";
        document.getElementById("lemon-sliced").style.display = "inline";
        alert("Nice cut!");
        revealNext();
      }

      if (draggedId === "ice-cube" && (target === "shaker" || target === "glass")) {
        alert(`Great! Ice added to the ${target}.`);
        revealNext();
      }
    }

    function revealNext() {
      const nextBtn = document.getElementById("next-button");
      if (nextBtn) {
        nextBtn.style.display = "inline-block";
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      const shaker = document.getElementById("shaker");
      if (shaker) {
        shaker.addEventListener("click", function () {
          shaker.classList.add("shake");
          setTimeout(() => {
            shaker.classList.remove("shake");
          }, 500);
        });
      }
    });
  </script>
</body>
{% endblock %}

