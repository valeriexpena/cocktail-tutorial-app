{% extends "base.html" %}

{% block title %}{{ cocktail_name }} - Step {{ step_id }}{% endblock %}

{% block content %}
<body class="learn-body">
  <h1 class="learn-title">How to Make {{ cocktail_name }}</h1>
  <h2>Step {{ step_id }}</h2>

  <div class="learn-flex-container">
    <div class="learn-flex-child">
      <p>{{ step_data["text_left"] }}</p>
      {% for img in step_data["media_left"] %}
        <img class="learn-img-large" src="/static/{{ img }}">
      {% endfor %}
    </div>

    <div class="learn-flex-child">
      <p>{{ step_data["text_right"] }}</p>
      {% for img in step_data["media_right"] %}
        {% if "lemon.png" in img %}
          <!-- Lemon: Drop target -->
          <img id="lemon" class="learn-img-small"
               src="/static/{{ img }}"
               ondragover="event.preventDefault()"
               ondrop="handleDrop(event)">
               
        {% elif "knife" in img %}
          <!-- Knife: Draggable -->
          <img id="knife" class="learn-img-small"
               src="/static/{{ img }}"
               draggable="true"
               ondragstart="handleDragStart(event)">

        {% elif "lemon_sliced.png" in img %}
          <!-- Sliced lemon: Hidden initially -->
          <img id="lemon-sliced" class="learn-img-small"
               src="/static/{{ img }}"
               style="display: none;"
               alt="Sliced lemon">

        {% else %}
          <img class="learn-img-small" src="/static/{{ img }}">
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <div style="margin-top: 40px;">
    {% if prev_step_id is not none %}
      <a href="/cocktail/{{ drink_id }}/step/{{ prev_step_id }}">
        <button class="button-back">Back</button>
      </a>
    {% endif %}

    {% if next_step_id is not none %}
      <a href="/cocktail/{{ drink_id }}/step/{{ next_step_id }}" id="next-button" style="display: none;">
        <button class="button-next">Next</button>
      </a>
    {% endif %}
  </div>

  <script>
    function handleDragStart(event) {
      event.dataTransfer.setData("text/plain", event.target.id);
    }

    function handleDrop(event) {
      event.preventDefault();
      const draggedId = event.dataTransfer.getData("text/plain");

      if (draggedId === "knife") {
        const wholeLemon = document.getElementById("lemon");
        const slicedLemon = document.getElementById("lemon-sliced");

        // Hide whole lemon
        if (wholeLemon) wholeLemon.style.display = "none";

        // Show sliced lemon
        if (slicedLemon) slicedLemon.style.display = "inline";

        // Reveal the Next button
        const nextBtn = document.getElementById("next-button");
        if (nextBtn) nextBtn.style.display = "inline-block";

        alert("Nice cut!");
      }
    }
  </script>
</body>
{% endblock %}

